#!/usr/bin/env bash
# usage: bin/compile <build-dir> <cache-dir>

set -e

build=$(cd "$1/" && pwd)
cache=$(cd "$2/" && pwd)

mkdir -p "$build" "$cache"

buildpack=$(dirname $(dirname $0))

ver=go${GOVERSION:-1.1.2}

file=${GOFILE:-$ver.$(uname|tr A-Z a-z)-amd64.tar.gz}
url=${GOURL:-http://go.googlecode.com/files/$file}

if test -d $cache/$ver/go
then
    echo "-----> Using $ver"
else
    rm -rf $cache/* # be sure not to build up cruft
    mkdir -p $cache/$ver
    cd $cache/$ver
    echo -n "-----> Installing $ver..."
    curl -sO $url
    tar zxf $file
    rm -f $file
    echo " done"
fi

mkdir -p $build/bin

cp $cache/$ver/go/bin/go $build/bin
